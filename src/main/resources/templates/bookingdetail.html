<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  <link href="https://fonts.googleapis.com/css?family=Roboto:400,100,300,700" rel="stylesheet" type="text/css" />

  <link rel="stylesheet" th:href="@{https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css}" />

  <link rel="stylesheet" th:href="@{/css/style.css}" />
  <link rel="stylesheet" th:href="@{/fonts/themify-icons-font/themify-icons/themify-icons.css}" />
  <link rel="stylesheet" th:href="@{/css/AdminLTE.css}" />
  <!-- thư viện để add header và footer  -->

  <link th:href="@{/css/bootstrap.min.copy.css}" rel="stylesheet" />
  <link rel="stylesheet" type="text/css" th:href="@{/css/slick-theme.css}" />
  <link rel="stylesheet" type="text/css" th:href="@{/css/slick.css}" />
  <link th:href="@{/css/mmenu.css}" rel="stylesheet" />
  <link th:href="@{/css/style.copy.css}" rel="stylesheet" />

  <link rel="shortcut icon" th:href="@{/images/favicon.png}" type="image/x-icon" />
  <link rel="icon" th:href="@{/images/favicon.png}" type="image/x-icon" />

  <!-- Responsive -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
</head>
<style>
  .btn-margin-bottom {
    margin-bottom: 20px;
    /* Adjust the value as necessary */
  }
</style>

<body>

  <div class="container mt-5">
    <h1 class="mb-3">Booking Detail</h1>
    <div>
      <a href="/booking" class="btn btn-secondary btn-margin-bottom">
        <i class="fas fa-arrow-left"></i> Back to List
      </a>
    </div>

    <table class="table">
      <thead class="thead-dark">
        <tr>
          <th>Booking ID</th>
          <th>Customer Name</th>
          <th>Check-In Date</th>
          <th>Check-Out Date</th>
          <th>Booking Date</th>
          <th>Customer Quantity</th>
          <th>Room ID</th>
          <th>Employee Name</th>
          <th>Delete</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="mapping : ${bookdetail.bookingMapping}">
          <td th:text="${bookdetail.bookingID}"></td>
          <td th:text="${bookdetail.customerID.customerName}"></td>
          <td th:text="${mapping.checkInDate}"></td>
          <td th:text="${mapping.checkOutDate}"></td>
          <td th:text="${#dates.format(bookdetail.bookingDate, 'dd-MM-yyyy')}"></td>
          <td th:text="${bookdetail.customerQuantity}"></td>
          <td th:text="${mapping.roomID.roomNum}"></td>
          <td>
            <span th:each="register : ${bookdetail.register}">
              <span th:text="${register.employeeID.fullName}"></span>
              <br />
            </span>
          </td>
          <td><a href="javascript:void(0);" th:onclick="'confirmDelete(' + ${mapping.roomID.id} + ');'"
            class="btn btn-danger ti-close"></a>
        </td>
        </tr>
      </tbody>
    </table>
  </div>
  <script>
    function confirmDelete(id) {
      if (confirm('Are you sure you want to delete it?')) {
        deleteBooking(id);
      }
    }

    function deleteBooking(id) {
      fetch(`/delete/${id}`, { // Ensure the endpoint matches the controller endpoint
        method: 'GET'
      })
        .then(response => {
          if (!response.ok) {
            throw new Error("Failed to delete booking");
          }
          return response.text(); // Read the response text
        })
        .then(message => {
          if (message === "Booking deleted successfully") {
            alert(message);
            location.reload(); // Reload the page to reflect the deletion
          } else {
            throw new Error(message); // If the message is not expected, throw an error
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert("An error occurred: " + error.message);
        });
    }


  </script>

  <!-- <div th:each="bookingMapping : ${bookingMappings}">
  <h2>Booking Mapping ID: <span th:text="${bookingMapping.bookingMappingID}"></span></h2>
  <p>Check-in Date: <span th:text="${bookingMapping.checkInDate}"></span></p>
  <p>Check-out Date: <span th:text="${bookingMapping.checkOutDate}"></span></p>
  <p>Booking Total Amount: <span th:text="${bookingMapping.bookingTotalAmount}"></span></p>
  <p>Room ID: <span th:text="${bookingMapping.room.roomID}"></span></p>
  <h3>Customer Information</h3>
  <p>Name: <span th:text="${bookingMapping.booking.customer.customerName}"></span></p>
  <p>Address: <span th:text="${bookingMapping.booking.customer.customerAddress}"></span></p>
  <p>Phone: <span th:text="${bookingMapping.booking.customer.customerPhone}"></span></p>
  <h3>Employee Information</h3>
  <div th:each="register : ${bookingMapping.booking.register}">
      <p>Name: <span th:text="${register.employee.name}"></span></p>
  </div>
</div> -->

</body>

</html>